<html>

<head>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="consoleBox">
        <h1>
            Console Stuff
        </h1>
        <div id="consoleWords"></div>
        <br> <br>
        <input type="text" id="userInput" placeholder="Enter Your Command Here (Press Enter To Exceute)">
    </div>

    <div id="mapBox">
        <h1>Map Of The World</h1>
        <iframe src="http://174.88.85.18:25567/" width='100%' height='600'></iframe>
        <a href="http://174.88.85.18:25567/">If You Would Like It Full-Screen (http://174.88.85.18:25567/)</a>

        <button onclick="goBack()">Log Out</button>

    </div>


    <script>
        setInterval(fetchLog, 2000);
        fetchLog();

        document.getElementById('userInput').addEventListener('keypress', function (event) {
            if (event.keyCode == 13) { //if enter key is pressed :)
                runCommand();
            }
        });

        function fetchLog() {
            //this is fetch stuff
            fetch('latest.log')
                .then(response => response.text())
                .then(logData => {

                    const lines = logData.split('\n'); //this spilts the text based off the /n (it auto generates /n when reading the file)

                    const last10Lines = lines.slice(-20); //this makes it where it only keeps the last 20 lines of data

                    const formattedLog = last10Lines.join('<br>'); //this joins the splited text with a <br> between them all

                    document.getElementById('consoleWords').innerHTML = formattedLog;
                })
                .catch(error => {
                    console.error('Error fetching log file:', error);
                });
        }

        function runCommand() {
            const { exec } = require('child_process');

            const command = 'mcrcon -H 174.88.85.18 -p password "deop WomanFunny"';

            // Example: execute the 'ls' command
            exec('ls', (error, stdout, stderr) => {
                if (error) {
                    console.error(`Error: ${error.message}`);
                    return;
                }
                if (stderr) {
                    console.error(`stderr: ${stderr}`);
                    return;
                }
                console.log(`stdout: ${stdout}`);
            });

            //location.reload(); //and this would reload the page, loading the log again
            fetchLog(); //or you could just run the fetch log thing again
            document.getElementById("userInput").value = ""; //this would enpty the text
        }

        function goBack() {
            window.location.href = "index.html";
        }
    </script>
</body>

</html>